#### Redis高性能分析



##### 1. 单线程

​	无锁, 没有上下文切换

##### 2. 纯内存

##### 3. 高效的数据结构

* 自定义的字符串类型

  ```c
  struct sdshdr {
    int len;
    int free;
    char buf[];
  }
  ```

  对比c本身的字符串, 相比, 有几个好处:

  * 常数时间获取字符串成长度.
  * 避免缓冲区溢出.
  * 预留一定的buf空间, 方便扩充, 减少重新分配内存次数.
  * 惰性释放内存空间, 有些情况不立即释放内存, 减少重新分配内存次数.

* 其他类型的数据结构

  * 字典中的渐进式rehash, 避免一次性做超长时间rehash
  * 压缩列表作为一种底层, 实现list和dict
  * 跳表实现set

##### 4. 多路IO复用

​	即**事件驱动**, 配合非阻塞的socket, 由系统通知哪些描述符可读. 通过select/poll/epoll/kqueue调用实现. 复用的即是线程(整合配合redis的单线程), 单个线程可以监控多个描述符.