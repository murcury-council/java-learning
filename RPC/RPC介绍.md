# RPC介绍

## 什么是 RPC

Remote Procedure Call，即远程过程调用，意指跨机器调用，所以需要用到网络编程才能实现。所以 RPC 是帮助我们**屏蔽网络编程细节**，实现远程调用方法跟调用本地方法一样的体验，不需要因为这个方法是远程调用就需要编写很多与业务无关的代码。作用主要体现在如下两个方面：

* 消除远程调用跟本地调用的区别
* 隐藏底层网络通信的复杂性，让我们更专注于业务逻辑

## RPC通信

调用方：发起调用请求的一方

服务提供方：被调用的一方

####底层细节

**网络传输的数据必须是二进制数据**，RPC 通过网络传输数据（一般默认采用 TCP 来传输），但是调用方请求的出入参数都是对象，需要提前转成可传输的二进制，并且要求转换算法是可逆的，这个过程叫作“序列化”。

服务提供方从 TCP 通道里收到二进制数据，*如何知道一个请求的数据到哪里结束，是一个什么类型的数据？*

像高速公路的指示牌一样，在数据包内建立指示牌，**把数据格式的*约定*内容叫作“协议”**

大多数的协议分成两部分：

* 数据头 —— 用于身份识别，包括协议标识、数据大小、请求类型、序列化类型等信息
* 消息体 —— 请求的业务参数信息和扩展属性等

根据协议格式，服务提供方就可以按照*约定*正确的从二进制数据中分割出不同的请求来，将请求还原成请求对象。这个过程叫作“反序列化”。

#### 简化 API，屏蔽掉 RPC 细节

由服务提供者给出业务接口声明，在调用方的程序里面，RPC 根据调用的服务接口**提前生成动态代理实现类**，并通过依赖注入等技术注入到声明了该接口的相关业务逻辑里面。该代理实现类会拦截所有的方法调用，在提供的方法处理逻辑里面完成一整套的远程调用，并吧远程调用结果返回给调用方。

<img src="https://static001.geekbang.org/resource/image/ac/fa/acf53138659f4982bbef02acdd30f1fa.jpg" style="zoom:80%;" />